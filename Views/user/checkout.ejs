<link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="../user/css/open-iconic-bootstrap.min.css">
<link rel="stylesheet" href="../user/css/animate.css">

<link rel="stylesheet" href="../user/css/owl.carousel.min.css">
<link rel="stylesheet" href="../user/css/owl.theme.default.min.css">
<link rel="stylesheet" href="../user/css/magnific-popup.css">

<link rel="stylesheet" href="../user/css/aos.css">

<link rel="stylesheet" href="../user/css/ionicons.min.css">

<link rel="stylesheet" href="../user/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="../user/css/jquery.timepicker.css">


<link rel="stylesheet" href="../user/css/flaticon.css">
<link rel="stylesheet" href="../user/css/icomoon.css">
<link rel="stylesheet" href="../user/css/style.css">


<div class="hero-wrap hero-bread" style="background-image: url('../user/img/bg_1.jpg');">
    <div class="container">
        <div class="row no-gutters slider-text align-items-center justify-content-center">
        <div class="col-md-9 ftco-animate text-center">
            <p class="breadcrumbs"><span class="mr-2"><a href="/">Home</a></span> <span>Checkout</span></p>
            <h1 class="mb-0 bread">Checkout</h1>
        </div>
        </div>
    </div>
    </div>

    <section class="ftco-section">
    <div class="container">
        <div class="row justify-content-center">
        <div class="col-xl-7 ftco-animate">
                        <form action="" class="billing-form" id="checkoutForm">

                            <div class="form-check my-2 mx-2">
                                <% for (var i=0; i<addressList.details.length;i++) { %>
                                    <input type="radio" 
                                    value="<%= addressList.details[i].name %>,<%= addressList.details[i].mobile %>,<%= addressList.details[i].address %>-<%= addressList.details[i].pincode %>" 
                                    class="form-check-input" id="check1" name="list" value="something" >
                                    <label class="form-check-label" for="check1">
                                        
                                        <div>
                                            <%= addressList.details[i].name %> <br>
                                             <%= addressList.details[i].mobile %>
                                        </div>
                                        
                                        <div>
                                            <%= addressList.details[i].country %> <br>
                                            <%= addressList.details[i].state %>
                                        </div>
                                        <div>
                                            <%= addressList.details[i].address %> - <%= addressList.details[i].pincode %>
                                        </div><br>
                                        <% } %>
                                    </label>
                            </div>

                            <div><a href="/addressAddPage" class="btn btn-primary ">Add New Address</a></div> 
            
                            <!-- <h3 class="mb-4 billing-heading">Billing Details</h3>

                            <label for="">Name</label>
                            <input type="text" class="form-control" name="name" id="name" required>

                            <label for="">Address</label>
                            <input type="text" class="form-control" name="address" id="address" required>

                            <label for="">Country</label>
                            <input type="text" class="form-control" name="country" id="country" required>

                            <label for="">State</label>
                            <input type="text" class="form-control" name="state" id="state" required>

                            <label for="">Pincode</label>
                            <input type="text" class="form-control" name="pincode" id="pincode" required>

                            <label for="">Mobile</label>
                            <input type="text" class="form-control" name="mobile" id="mobile" required>
                            <input type="text" name="userId" id=""  value="<%= userData._id %>" hidden>
                            </div> 
           END -->
                   </div>
                    <div class="col-xl-5">
            <div class="row mt-5 pt-3">
                <div class="col-md-12 d-flex mb-5">
                    <div class="cart-detail cart-total p-3 p-md-4">
                        <h3 class="billing-heading mb-4">Cart Total</h3>
                        <!-- <p class="d-flex">
                                    <span>Subtotal</span>
                                    <span>Rs.<%= totalValue %></span>
                                </p>
                                <p class="d-flex">
                                    <span>Delivery</span>
                                    <span>Rs.0</span>
                                </p> -->
                                <!-- <p class="d-flex">
                                    <span>Discount</span>
                                    <span>$3.00</span>
                                </p> -->
                                <!-- <hr> -->
                                <p class="d-flex total-price">
                                    <span>Total</span>
                                    <span>Rs.<%= totalValue %></span>
                                </p>
                                </div>
                </div>
                <div class="col-md-12">
                    <div class="cart-detail p-3 p-md-4">
                        <h3 class="billing-heading mb-4">Payment Method</h3>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="radio">
                                            <label><input type="radio" name="payment-method" class="mr-2" value="COD" checked>COD</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="radio">
                                            <label><input type="radio" name="payment-method" class="mr-2" value="ONLINE">Online Payment</label>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="radio">
                                            <label><input type="radio" name="optradio" class="mr-2"> Paypal</label>
                                            </div>
                                        </div>
                                    </div> -->
                                    <!-- <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="checkbox">
                                            <label><input type="checkbox" value="" class="mr-2"> I have read and accept the terms and conditions</label>
                                            </div>
                                        </div>
                                    </div> -->
                                    <input type="text" name="userId" id=""  value="<%= userData._id %>" hidden>
                                    <button class="btn btn-primary py-3 px-4" type="submit">Place an Order</button>
                                </div>
                </div>
            </div>
        </div> 
        </div>
    </div>
</form>
    </section>


    <script src="../user/js/jquery.min.js"></script>
    <script src="../user/js/jquery-migrate-3.0.1.min.js"></script>
    <script src="../user/js/popper.min.js"></script>
    <script src="../user/js/bootstrap.min.js"></script>
    <script src="../user/js/jquery.easing.1.3.js"></script>
    <script src="../user/js/jquery.waypoints.min.js"></script>
    <script src="../user/js/jquery.stellar.min.js"></script>
    <script src="../user/js/owl.carousel.min.js"></script>
    <script src="../user/js/jquery.magnific-popup.min.js"></script>
    <script src="../user/js/aos.js"></script>
    <script src="../user/js/jquery.animateNumber.min.js"></script>
    <script src="../user/js/bootstrap-datepicker.js"></script>
    <script src="../user/js/scrollax.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="../user/js/google-map.js"></script>
    <script src="../user/js/main.js"></script>


    <script>
        $('#checkoutForm').submit((e)=>{
            e.preventDefault()
            $.ajax({
                url:'/placeOrder',
                method:'post',
                data:$('#checkoutForm').serialize(),
                success:(response)=>{
                    if(response.codSuccess){
                    window.location.href='/order-success'
                    }else{
                        razorpayPayment(response)
                    }
                }
            })
        })

        function razorpayPayment(order){
            var options = {
    "key": "rzp_test_B60nPeKFrDrUak", // Enter the Key ID generated from the Dashboard
    "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Foody",
    "description": "Test Transaction",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){

        verifyPayment(response,order)
    },
    "callback_url": "https://eneqd3r9zrjok.x.pipedream.net/",
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
    };
    var rzp1 = new Razorpay(options);
    rzp1.open();    
        }
        function verifyPayment(payment,order){
        $.ajax({
            url:'/verifyPayment',
            data:{
                payment,
                order
            },
            method:'post',
            success:(response)=>{
                if(response.status){
                    location.href='/order-success'
                }else{
                    alert("Payment Failed")
                }
            }
        })
    }
    </script>

















    <script>
          $(document).ready(function(){
  
          var quantitiy=0;
             $('.quantity-right-plus').click(function(e){
                  
                  // Stop acting like a button
                  e.preventDefault();
                  // Get the field name
                  var quantity = parseInt($('#quantity').val());
                  
                  // If is not undefined
                      
                      $('#quantity').val(quantity + 1);
  
                    
                      // Increment
                  
              });
  
               $('.quantity-left-minus').click(function(e){
                  // Stop acting like a button
                  e.preventDefault();
                  // Get the field name
                  var quantity = parseInt($('#quantity').val());
                  
                  // If is not undefined
                
                      // Increment
                      if(quantity>0){
                      $('#quantity').val(quantity - 1);
                      }
              });
              
          });
      </script>