<section class="home-section">
<!-- Button trigger modal -->
<div class="d-grid gap-2 d-md-flex justify-content-md-end m-5">
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  Add Category
</button>
</div>

<form action="/admin/addCategory" method="post" enctype="multipart/form-data"  onsubmit="return categoryValidation()">
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Add Category</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label for="addCategory">Add Category</label>
        <input type="text" name="newCategory" id="newCategory"><br><br>
        <label for="addCategory">Category Image</label>
        <input  name="categoryImage" type="file" class="form-control" id="inputGroupFile04" aria-describedby="inputGroupFileAddon04" aria-label="Upload" required>
      </div>
      <span class="text-danger text-center" id="categoryError"></span>
      <div class="modal-footer">
        <button type="submit" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>
</form>
</div>
</section>

<section class="home-section">
  <div class="container mt-5">
    <table class="table p-4" id="categoryTable">
      <thead>
        <tr>
          <th scope="col">S.NO</th>
          <th scope="col">Category Name</th>
          <th scope="col">Category Image</th>
          <th scope="col">Edit Category</th>
          <th scope="col">Delete Category</th>
        </tr>
      </thead>
      <tbody>
        <% for (var i=0;i<category.length;i++) {%> 
        <tr>
          <th scope="row"><%= i+1 %></th>
          <td><%= category[i].newCategory %></td>
          <td> <img src="/admin/images/<%= category[i].categoryImage %>" style="width: 75px; height: 75px;" alt=""></td>
          <td><a class="btn btn-primary" href="/admin/editCategory?id=<%= category[i]._id%>">Edit</a></td>
          <td><a class="btn btn-danger" href="#" onclick="deleteCategory('<%= category[i]._id %>')">Delete</a></td>
        </tr>
       <% } %>
      </tbody>
    </table>
   </div>
</section>
 <script>
  
const myModal = document.getElementById('myModal')
const myInput = document.getElementById('myInput')

myModal.addEventListener('shown.bs.modal', () => {
  myInput.focus()
})
 </script>

<script>
  function categoryValidation(){
    let flag=0
    let category = document.getElementById('newCategory').value.trim()

    if(category === ''){
      document.getElementById('categoryError').innerHTML = 'Category Required'
      flag=1
    }
    else{
      document.getElementById('categoryError').innerHTML= ''
    }

    if(flag == 1){
      return false
    }
  }


    function deleteCategory(categoryId){
      swal({
      title: "DELETE",
      text: "DO YOU WANT TO DELETE THIS CATEGORY!",
      icon: "warning",
      buttons: ["CANCEL","OK"],
    }).then(val=>{
      if(val){
        fetch('/admin/deleteCategory?id='+categoryId,
        {
          method:'delete'
        }
        ).then(res=> res.json()).then(data=>{
          if(data.status){
            swal({
      title: "SUCCESS",
      text: "CATEGORY SUCCESSFULLY DELETED",
      icon: "success",
      button:"OK",
    }).then(val=>{
      location.reload()
    })
          }else{
            swal({
      title: "WARNING",
      text: "CATEGORY ALREADY IN USE ",
      icon: "warning",
      button:"OK",
    }).then(val=>{
      location.reload()
    })
          }
        })
      }
    })
    }


</script>


<script>
  $(document).ready( function () {
    $('#categoryTable').DataTable();
  } );
  </script>










<script>
  let sidebar = document.querySelector(".sidebar");
 let sidebarBtn = document.querySelector(".sidebarBtn");
 sidebarBtn.onclick = function() {
 sidebar.classList.toggle("active");
 if(sidebar.classList.contains("active")){
 sidebarBtn.classList.replace("bx-menu" ,"bx-menu-alt-right"); 
 }else
 sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
 }
 </script>